{% extends "todolist/breadcrumbs_todolist.html" %}
{% load static %}
{% load humanize %}
{% load markdown_extras %}
{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb task.title "todolist:detail_task" task.pk %}
{% endblock %}


{% block header %}
<link rel="stylesheet" href="{% static 'css/custom_checkbox.css' %}">
{# code syntax #}
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/styles/dracula.min.css">
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
{# MathJax #}
<script>
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process',
    renderActions: {
      find: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          const sibling = node.previousElementSibling;
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
          if (sibling && sibling.matches('.MathJax_Preview')) {
            sibling.parentNode.removeChild(sibling);
          }
        }
      }, '']
    }
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="card col-12">
        <article>
            {% if user.is_staff or user.is_superuser or task.user.pk == user.pk %}
            <section>
                <div class="row">
                    <div class="col-12">
                        <h1 class="h1">{{ task.title }}</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <time datetime="{{ task.updated_at|date:'Y-m-d' }}">{{ task.updated_at|naturaltime }}に更新</time>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        {{ task.text | markdown2html }}
                    </div>
                </div>
            </section>
            {% else %}
            <p>記事を表示する権限がありません。</p>
            {% endif %}
        </article>
    </div>
</div>
{% endblock %}
